<section class="panel">
  <header class="panel__header">
    <p class="eyebrow">Kundenübersicht</p>
    <h1>Kundendetails</h1>
    <p class="subtitle">Alle wichtigen Informationen zum ausgewählten Kunden.</p>
  </header>

  <p class="status status--error" *ngIf="errorMessage()">{{ errorMessage() }}</p>
  <p class="status" *ngIf="isLoading()">Kunde wird geladen...</p>

  <div class="detail" *ngIf="!isLoading() && customer()">
    <div class="detail__row">
      <span class="detail__label">ID</span>
      <span class="detail__value">#{{ customer()?.id }}</span>
    </div>
    <div class="detail__row">
      <span class="detail__label">Name</span>
      <span class="detail__value">{{ customer()?.name }}</span>
    </div>
  </div>

  <div class="plants" *ngIf="!isLoading() && customer()">
    <div class="plants__header">
      <h2>Filteranlagen</h2>
      <button class="primary-button" type="button" (click)="togglePlantForm()">
        Filteranlage anlegen
      </button>
    </div>
    <form class="plants__form" *ngIf="showPlantForm()" (ngSubmit)="createFilterPlant()">
      <label class="field">
        <span class="field__label">Beschreibung</span>
        <input
          class="field__input"
          type="text"
          name="plantDescription"
          [(ngModel)]="plantDescription"
          placeholder="Kurzbeschreibung"
        />
      </label>
      <label class="field">
        <span class="field__label">Hersteller</span>
        <select
          class="field__input"
          name="manufacturerId"
          [(ngModel)]="selectedManufacturerId"
          required
        >
          <option [ngValue]="null" disabled>Hersteller auswählen</option>
          <option *ngFor="let manufacturer of manufacturers()" [ngValue]="manufacturer.id">
            {{ manufacturer.name }}
          </option>
        </select>
      </label>
      <label class="field">
        <span class="field__label">Baujahr</span>
        <input
          class="field__input"
          type="number"
          name="plantYear"
          [(ngModel)]="plantYear"
          placeholder="z.B. 2020"
        />
      </label>
      <div class="plants__actions">
        <button class="ghost-link-button" type="button" (click)="togglePlantForm()">Abbrechen</button>
        <button class="primary-button" type="submit">Speichern</button>
      </div>
    </form>
    <p class="status status--error" *ngIf="plantError()">{{ plantError() }}</p>
    <div class="plants__list" *ngIf="filterPlants().length > 0">
      <div class="plants__row" *ngFor="let plant of filterPlants()">
        <div>
          <p class="plants__title">{{ plant.description }}</p>
          <p class="plants__meta">Baujahr {{ plant.year_built }}</p>
        </div>
        <div class="plants__actions">
          <a
            class="ghost-link-button"
            [routerLink]="['/customers', customer()?.id, 'filter-plants', plant.id]"
          >
            Details
          </a>
          <a
            class="primary-button"
            [routerLink]="[
              '/customers',
              customer()?.id,
              'filter-plants',
              plant.id,
              'reports',
              'new'
            ]"
          >
            Bericht erstellen
          </a>
        </div>
      </div>
    </div>
    <p class="empty" *ngIf="filterPlants().length === 0">
      Noch keine Filteranlagen. Lege oben die erste an.
    </p>
  </div>

  <div class="reports" *ngIf="!isLoading() && customer()">
    <div class="reports__header">
      <h2>Berichte</h2>
      <a class="ghost-link-button" routerLink="/reports">Zur Berichtsübersicht</a>
    </div>
    <p class="status status--error" *ngIf="reportError()">{{ reportError() }}</p>
    <div class="reports__list" *ngIf="reports().length > 0">
      <div class="reports__row" *ngFor="let report of reports()">
        <div>
          <p class="reports__title">Bericht #{{ report.id }}</p>
          <p class="reports__meta">{{ report.filter_plant_description }}</p>
        </div>
        <div class="reports__actions">
          <span class="reports__date">{{ report.created_at | date: 'short' }}</span>
          <a
            class="ghost-link-button"
            [routerLink]="['/reports', report.id]"
          >
            Bericht öffnen
          </a>
        </div>
      </div>
    </div>
    <p class="empty" *ngIf="reports().length === 0">
      Noch keine Berichte vorhanden.
    </p>
  </div>

  <div class="actions" *ngIf="customer()">
    <a class="ghost-link-button" routerLink="/">Zurück zur Kundenübersicht</a>
    <a class="primary-button" [routerLink]="['/customers', customer()?.id, 'edit']">
      Kunden bearbeiten
    </a>
  </div>
</section>

<div class="modal modal--success" *ngIf="plantSuccess()">
  <div class="modal__overlay"></div>
  <div class="modal__content modal__content--success">
    <h2>Erfolg</h2>
    <p>{{ plantSuccess() }}</p>
    <div class="modal__actions">
      <button class="ghost-button" type="button" (click)="dismissPlantSuccess()">OK</button>
    </div>
  </div>
</div>
